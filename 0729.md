# 网络基础-2(网络层)

## 网络层

### IP (Internet Protocol Address) 网络协议地址

每台计算机都有一个唯一地址，方便别人查找

#### IP头部

![image](/image/network/IP报文.jpeg)

字段|说明|
-|:-:|
版本|Version）字段： 占4比特。用来表明IP协议实现的版本号，当前一般为IP4，即0100|
首部长度|报头长度(Internet Header Length, IHL)字段: 占4比特。是头部占32比特的数字，包括可选项。普通IP数据报(没有任何选项)，该字段的值是5，即160比特=20字节。此字段最大值为60字节|
优先级与服务类型|占8比特。其中的前3比特为优先权子字段(Precedence,现已经被忽略)。第8比特保留未用。第4至第7比特分别代表延迟、吞吐量、可靠性和花费。当它们取值为1时分别代表要求最小时延、最大吞吐量、最高可靠性和最小费用。这4比特的服务类型中只能置其中1比特为1.可以全为0，若全为0则表示一般服务。服务类型字段声明了数据报被网络系统传输时可以被怎么处理。🌰：**TELNET协议**可能要求最小的延迟，**FTP协议**(数据)可能要求有最大吞吐量，**SNMP协议**可能要求有最高可靠性，**NNTP(Network News Transfer Protocol，网络新闻传输协议)**可能要求最小费用，而**ICMP协议**可能无特殊要求(4比特全为0)|
总长度|占16比特。指明整个数据报的长度(以字节为单位)。最大长度为65535字节|
标识符|占16比特。用来唯一的标识主机发送的每一份数据报。通常每发一份报文，它的值会+1|
标志|分为3个字段，依次为保留位。不分片位和更多片位|
标志|保留位：一般被置为0|
标志|不分片位：表示该数据是否被分片，如果被置为1，则不能对数据进行分片，如果对其进行分片处理，就应将其置为0|
标志|更多片位：除了最后一个分片，其它每个组成数据报的片都要将该位置设置为1|
段偏移量|占13比特。如果一份数据报要求分段的话，此字段指明该段偏移距原始数据报开始的位置|
TTL(Time To Live 生存时间)|该字段用于表示IP数据包的生命周期，可以防止一个数据包在网络中无循环的发下去。TTL的意思是一个数据包在被丢弃之前在网络上的最大周转时间。该数据包经过的每一个路由器都会检查该字段中的值，当TTL的值为0时，此数据包会被丢弃。TTL对应于一个数据包通过路由器的数目，一个数据包每经过一个路由器，TTL将-1|
协议号|占8比特。指明IP层所封装的上层协议类型，如ICMP(1)、IGMP(2)、TCP(6)、UDP(17)等|
首部校验和|检验和是16位的错误检测字段。目的主机和网络中的每个网关都要重新计算报头的校验和，一样表示没有改动过，计算方法是，对头部中每个16比特进行二进制反码求和|
源IP地址|该字段用于表示数据包的原地址，指的是发送该数据包的设备网络地址|
目标IP地址|该字段用于表示数据包的目标地址，指的是接收节点的网络地址|

#### IP地址格式

- IP地址是一个网络编码，用来确定网络的一个节点。
- IP地址是由32位二进制(32bit)组成。
- IP地址分为**网络部分**(由Internet网络地址分配机构统一分配，可以确保唯一性)和**主机部分**。

![image](/image/network/IP网络本机部分.png)

#### 公有地址和私有地址

分类|范围|
-|:-:|
A类私有IP|10.0.0.0 ~ 10.255.255.255|
B类私有IP|172.16.0.0 ~ 172.31.255.255|
C类私有IP|192.168.0.0 ~ 192.168.255.255|

其他范围均为公有IP地址

地址分配情况
![image](/image/network/IP类型.jpeg)

#### 子网掩码(subnet mask)

- 又名**子网络遮罩**，他是一种用来指明一个IP地址的哪些位标识的是主机所在的子网，以及哪些位标识的是主机位的掩码。
- 子网掩码不能单独存在，他必须结合IP地址一起使用。
- 子网掩码唯一作用时将某个IP地址划分为网络地址和主机地址。
- 子网掩码也是32个二进制位。
- 对应IP地址的网络部分用1表示，主机部分用0表示。

![image](/image/network/子网掩码2.jpeg)

- IP地址和子网掩码做**逻辑与**运算得到网络地址
    1. 0与任何数与运算都是0
    2. 1和任何数运算都是任何数本身

- A B C 三类地址都有自己默认的子网掩码

    1. A类 255.0.0.0
    2. B类 255.255.0.0
    3. C类 255.255.255.0

![image](/image/network/子网掩码1.jpeg)

🌰 C类地址应用子网掩码

- IP地址 192.168.5.139
- 子网掩码 255.255.255.224

补充

* 两个IP是否在同一局域网取决于子网掩码(拿两个IP分别和子网掩码做与运算)
* 划分局域网是 **物理** 和 **子网** 划分
* 私有IP解决了IP不够用的情况
