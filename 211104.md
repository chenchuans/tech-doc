# webpack 基础用法

## webpack 文件监听

### 监听实现

- 启动 `webpack` 命令 带上 `--watch`
- 配置中 `webpack.config.js` 设置 `watch: true`

### 监听原理

轮询判断文件最后便是时间是否发生了变化

某个文件发生了变化，并不会立刻告诉监听者，而是先缓存起来吗，等 `agreegateTimeout`

``` javascript
module.exports = {
    // 默认为false，也就是不开启监听
    watch: true,
    // 只有开启监听，watchOptions才起作用
    watchOptions: {
        // 默认为空，不监听的文件或者文件夹，支持正则匹配
        ignore: /node_modules/,
        // 监听到变化发生后会等300ms再去执行，默认300ms
        agreegateTimeout: 300,
        // 判断文件是否发生了变化是通过不停询问系统指定文件有没有实现变化实现的，默认每秒轮询1000次，也就是1ms一次
        poll: 1000,
    }
}
```

## webpack 热更新

### webpack-dev-server

- wds 不刷新浏览器
- wds 不输出文件，而是放在内存中
- 使用 `HotModuleReplacementPlugin` 插件

``` javascript
{
    "name": "hello",
    "version": "1.0.0",
    "main": "index.js",
    "scripts": {
        "build": "webpack",
        "dev": "webpack-dev-server --open",
    },
}
```

### webpack-dev-middleware

- wdm 将 webpack 输出的文件传输给服务器
- 适用于灵活定制场景

``` javascript
const express = require('express')
const webpack = require('webpack')
const webpackDevMiddleware = require('webpack-dev-middleware')

const app = express()
const config = require('./webpack.config.js')
const compiler = webpack(config)

app.use(webpackDevMiddleware(compiler, {
    publicPath: config.output.publicPath
}))

app.listen(3000, function(params) {
    console.log('Example app listening on port 3000!\n')
})
```

### 热更新原理分析

- Webpack Compile: 将 JS 编译成 Bundle
- HMR Server: 将热更新的文件输出给 HMR Runtime
- Bundle server: 提供文件在浏览器的访问
- HMR Runtime: 会被注入到浏览器，更新文件的变化
- bundle.js: 构建输出的文件

Runtime Bundle server服务器与浏览器建立websocket联系

![image](/image/ownwebpack/1.png)

